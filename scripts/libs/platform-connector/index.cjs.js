"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof=require("@babel/runtime/helpers/typeof"),_asyncToGenerator=require("@babel/runtime/helpers/asyncToGenerator"),_classCallCheck=require("@babel/runtime/helpers/classCallCheck"),_createClass=require("@babel/runtime/helpers/createClass"),_regeneratorRuntime=require("@babel/runtime/regenerator"),_defineProperty=require("@babel/runtime/helpers/defineProperty"),_slicedToArray=require("@babel/runtime/helpers/slicedToArray"),clone=require("lodash/clone"),merge=require("lodash/merge"),urlTemplate=require("url-template"),exponentialBackoff=require("exponential-backoff"),_inherits=require("@babel/runtime/helpers/inherits"),_possibleConstructorReturn=require("@babel/runtime/helpers/possibleConstructorReturn"),_getPrototypeOf=require("@babel/runtime/helpers/getPrototypeOf"),_wrapNativeSuper=require("@babel/runtime/helpers/wrapNativeSuper"),fs=require("fs"),events=require("events"),nodeFetch=require("node-fetch-npm"),webFilePolyfill=require("web-file-polyfill"),HeadersPolyfill=require("fetch-headers/headers-es5.min.js"),atobPolyfill=require("atob"),urlPolyfill=require("url"),blobPolyfill=require("blob-polyfill"),xmlhttprequest=require("xmlhttprequest");function _interopDefaultCompat(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _typeof__default=_interopDefaultCompat(_typeof),_asyncToGenerator__default=_interopDefaultCompat(_asyncToGenerator),_classCallCheck__default=_interopDefaultCompat(_classCallCheck),_createClass__default=_interopDefaultCompat(_createClass),_regeneratorRuntime__default=_interopDefaultCompat(_regeneratorRuntime),_defineProperty__default=_interopDefaultCompat(_defineProperty),_slicedToArray__default=_interopDefaultCompat(_slicedToArray),clone__default=_interopDefaultCompat(clone),merge__default=_interopDefaultCompat(merge),urlTemplate__default=_interopDefaultCompat(urlTemplate),_inherits__default=_interopDefaultCompat(_inherits),_possibleConstructorReturn__default=_interopDefaultCompat(_possibleConstructorReturn),_getPrototypeOf__default=_interopDefaultCompat(_getPrototypeOf),_wrapNativeSuper__default=_interopDefaultCompat(_wrapNativeSuper),fs__default=_interopDefaultCompat(fs),nodeFetch__default=_interopDefaultCompat(nodeFetch),HeadersPolyfill__default=_interopDefaultCompat(HeadersPolyfill),atobPolyfill__default=_interopDefaultCompat(atobPolyfill),urlPolyfill__default=_interopDefaultCompat(urlPolyfill);function getMimeTypeFromExtension(e){var t="";switch(e=e.toLowerCase()){case"jpeg":t="image/jpeg";break;case"jpg":t="image/jpg";break;case"png":t="image/png";break;case"tiff":t="image/tiff";break;case"bmp":t="image/bmp";break;case"psd":t="image/psd";break;case"gif":t="image/gif";break;case"pdf":t="application/pdf";break;case"eps":t="image/x-eps";break;case"ai":t="application/illustrator";break;case"txt":t="text/plain";break;case"rtf":t="text/rtf";break;case"ppt":case"pptx":t="application/mspowerpoint";break;case"doc":case"docx":t="application/msword";break;case"xls":case"xlsx":t="application/msexcel";break;case"indd":t="application/x-indesign";break;case"raw":t="image/raw";break;case"avi":t="video/msvideo";break;case"flv":t="video/x-flv";break;case"mp4":t="video/mp4";break;case"mpeg":t="video/mpeg";break;case"wmv":t="video/x-ms-wmv";break;case"psb":t="application/x-photoshop";break;case"f4v":t="video/x-f4v";break;case"asf":t="application/vnd.ms-asf";break;case"3gp":t="video/3gpp";break;case"swf":t="application/x-shockwave-flash";break;default:t="application/octet-stream"}return t}var PlatformConnectorConstants={UPLOAD_STATE:{PENDING:"PENDING",ACTIVE:"ACTIVE",PAUSING:"PAUSING",PAUSED:"PAUSED",CANCELING:"CANCELING",CANCELED:"CANCELED",RESUMING:"RESUMING",FINISHED:"FINISHED"},UPLOAD_BLOCKS:{MIN_FILESIZE_FOR_BLOCKUPLOAD:52428800,UPLOAD_BLOCKSIZE:5242880,MIN_BLOCKSIZE_FOR_UPLOAD:5242880,UPLOAD_BLOCK_RETRY_DEFAULT:3},DIRECTORY_TYPE:"application/vnd.adobecloud.directory+json",RESOURCE_TYPE:"application/vnd.adobecloud.resource+json",COLLECTION_TYPE:"application/vnd.adobeaemcloud.collection+json",REPO_PATH:"repo:path"},DISCOVERY={root:"/discovery"},LINK_NS={page:"http://ns.adobe.com/adobecloud/rel/page",next:"next",resolveId:"http://ns.adobe.com/adobecloud/rel/resolve/id",resolvePath:"http://ns.adobe.com/adobecloud/rel/resolve/path",ops:"http://ns.adobe.com/adobecloud/rel/ops",metadata:{repo:"http://ns.adobe.com/adobecloud/rel/metadata/repository",app:"http://ns.adobe.com/adobecloud/rel/metadata/application",embedded:"http://ns.adobe.com/adobecloud/rel/metadata/embedded",asset:"http://ns.adobe.com/adobecloud/rel/metadata/asset"},query:"http://ns.adobe.com/adobecloud/rel/query",rendition:"http://ns.adobe.com/adobecloud/rel/rendition",path:"http://ns.adobe.com/adobecloud/rel/path",acPolicy:"http://ns.adobe.com/adobecloud/rel/ac/policy",id:"http://ns.adobe.com/adobecloud/rel/id",acCheck:"http://ns.adobe.com/adobecloud/rel/ac/check",repository:"http://ns.adobe.com/adobecloud/rel/repository",primary:"http://ns.adobe.com/adobecloud/rel/primary",acEffective:"http://ns.adobe.com/adobecloud/rel/ac/effective",create:"http://ns.adobe.com/adobecloud/rel/create",directory:"http://ns.adobe.com/adobecloud/rel/directory",discard:"http://ns.adobe.com/adobecloud/rel/discard",restore:"http://ns.adobe.com/adobecloud/rel/restore",download:"http://ns.adobe.com/adobecloud/rel/download",version:"version-history",blockUploadInit:"http://ns.adobe.com/adobecloud/rel/block/init",blockTransfer:"http://ns.adobe.com/adobecloud/rel/block/transfer",blockFinalize:"http://ns.adobe.com/adobecloud/rel/block/finalize",blockDownload:"http://ns.adobe.com/adobecloud/rel/download",searchableFields:"http://ns.adobe.com/adobeaemcloud/rel/aem/metadata/searchable-fields",collections:"http://ns.adobe.com/adobeaemcloud/rel/aem/collections-v0"};function ownKeys$3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(r),!0).forEach((function(t){_defineProperty__default.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}exports.LogLevel=void 0,function(e){e[e.NONE=-1]="NONE",e[e.SEVERE=0]="SEVERE",e[e.WARNING=1]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.CONFIG=4]="CONFIG",e[e.FINE=5]="FINE",e[e.FINER=6]="FINER",e[e.FINEST=7]="FINEST"}(exports.LogLevel||(exports.LogLevel={}));var DEFAULT_LOGGER_NO_OP={log:function(){}},Logger={isLogger:function(e){return"object"===_typeof__default.default(e)&&"log"in e},_logger:DEFAULT_LOGGER_NO_OP,setLogger:function(e){if(e){if(!Logger.isLogger(e))throw new Error("Invalid logger object");Logger._logger=e}else Logger._logger=DEFAULT_LOGGER_NO_OP},log:function(e,t){Logger._logger.log(e,t)}},ConsoleLogger=function(){function e(t){_classCallCheck__default.default(this,e),this.traceLevel=void 0,this.traceLevel=t}return _createClass__default.default(e,[{key:"log",value:function(e,t){var r=exports.LogLevel[e],n="".concat(new Date," ").substring(0,33),a="".concat(n," - ").concat(r,":").concat(t.message);t=_objectSpread$3(_objectSpread$3({},t),{},{message:a}),this.traceLevel>=e&&(e===exports.LogLevel.SEVERE?console.error(t.message):e===exports.LogLevel.WARNING?console.warn(t.message):e===exports.LogLevel.INFO?console.info(t.message):e===exports.LogLevel.DEBUG?console.debug(t.message):console.log(t.message))}}]),e}();function _createForOfIteratorHelper$1(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,o=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var utils={getAuthHeader:function(e){return e.accessToken&&e.accessToken.startsWith("Basic")?{authorization:"".concat(e.accessToken),"x-api-key":e.apiKey}:{authorization:"Bearer ".concat(e.accessToken),"x-api-key":e.apiKey}},getHeader:function(e,t){return merge__default.default(utils.getAuthHeader(t),e)},extendTemplate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e,n=RegExp("{([^}]+)}","g"),a={},o="";if(r){var u;do{if(u=n.exec(e)){for(var s=u[0],i=u[1].replace(/[\?]/g,"").replace(/;/g,"").replace(/\+/g,"").split(","),l=0;l<i.length;l++)a[i[l]]=!0;0===s.indexOf("{?")&&(o=s)}}while(u);var c=[],f=!1;if(Object.keys(t).forEach((function(e){a[e]||(new RegExp("[?&]".concat(e,"=([^};&]*)")).test(r)?f=!0:c.push(e))})),c.length){var d=c.join(",");if(0==o.length)r+=f?"{&".concat(d,"}"):"{?".concat(d,"}");else{var p=o.replace("}",",".concat(d,"}"));r=r.replace(o,p)}}}return r},fillTemplate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;if(r){var n,a=RegExp("{[^}]+}","gm");do{if(n=a.exec(e)){var o=n[0].replace(/\?}/g,"}").replace(/\?,/g,",");r=r.replace(n[0],o)}}while(n);r=this.extendTemplate(r,t)}return urlTemplate__default.default.parse(r).expand(t)},extractLinksFromHeaders:function(e){var t,r={},n=_createForOfIteratorHelper$1(e.get("link").split(", <"));try{for(n.s();!(t=n.n()).done;){var a,o=t.value.split(/>;|";/g),u="",s="",i="",l=_createForOfIteratorHelper$1(o);try{for(l.s();!(a=l.n()).done;){var c=a.value;c.indexOf("rel=")>=0?u=c.replace("rel=","").replace(/"/g,"").trim():c.indexOf("templated=")>=0?i=c.replace("templated=","").replace(/"/g,"").trim():(c.startsWith("<")||c.startsWith("https://")||c.startsWith("/"))&&(s=c.replace(/[<>]/g,"").trim())}}catch(e){l.e(e)}finally{l.f()}r[u]={href:s},i&&(r[u].templated="true"===i)}}catch(e){n.e(e)}finally{n.f()}return r},findLink:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e[t]&&e[t].href)return e[t].href.startsWith("http://")||e[t].href.startsWith("https://")?e[t].href:r+(e[t].href.startsWith("/")?"":"/")+e[t].href;if(Array.isArray(e[t])){var n=e[t].filter((function(e){return"id"===e.mode})).concat(e[t]),a=_slicedToArray__default.default(n,1)[0];if(a&&a.href)return a.href.startsWith("http://")||a.href.startsWith("https://")?a.href:r+(a.href.startsWith("/")?"":"/")+a.href}throw new Error("".concat(t," link not available on this asset"))},extractFileName:function(e){return e.substring(e.lastIndexOf("/")+1)},formatDirectoryPath:function(e){return e.lastIndexOf("/")!==e.length-1?"".concat(e,"/"):e},getErrorFromResponse:function(e){var t={status:e.status,statusText:e.statusText};return e.headers&&e.headers.get("x-request-id")&&(t["x-request-id"]=e.headers.get("x-request-id")),t},waitFor:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),returnXHRResponse:function(e,t,r,n,a){var o;if(4===e.readyState){var u={ok:e.status<=399,json:function(){return JSON.parse(e.responseText)},headers:new Headers,redirected:!1,status:e.status,statusText:e.statusText,trailer:null,type:null,url:e.responseURL,clone:null,body:null,bodyUsed:!0,arrayBuffer:null,blob:null,text:function(){return Promise.resolve(e.responseText)},formData:null},s=null!==(o=e.getResponseHeader("x-request-id"))&&void 0!==o?o:"NO ID";return u.ok?("PUT"===t&&blockTransfers.removeXhrPut(a),Logger.log(exports.LogLevel.FINE,{message:" < pc ".concat(t," ").concat(u.status," [").concat(s,"] ").concat(a),requestUrl:u.url,requestMethod:t,xRequestId:s,filledTemplate:a}),r(u)):(Logger.log(exports.LogLevel.WARNING,{message:" < pc ".concat(t," ").concat(u.status," [").concat(s,"] ").concat(a),requestUrl:u.url,requestMethod:t,responseStatus:u.status,xRequestId:s,filledTemplate:a}),n(u))}}};function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf__default.default(e);if(t){var a=_getPrototypeOf__default.default(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn__default.default(this,r)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var WrappedFetchError=function(e){_inherits__default.default(r,e);var t=_createSuper(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck__default.default(this,r),(n=t.call(this,e||"Request failed with status code ".concat(a))).forceSkip=void 0,n.isAxiosError=void 0,n.response=void 0,n.message=e||"Request failed with status code ".concat(a),n.isAxiosError=!0,a&&(n.response={status:a,headers:o}),n}return _createClass__default.default(r,null,[{key:"fromFetchError",value:function(e){return new r(e)}}]),r}(_wrapNativeSuper__default.default(Error));function ownKeys$2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(r),!0).forEach((function(t){_defineProperty__default.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function isRetryError(e){if(e.isAxiosError){var t=e.response,r=(void 0===t?{}:t).status;return r>=500&&r<600||!r}return!1}function getHttpErrorInfo(e){var t="Internal Server Error",r={status:500,statusText:t};if(e){var n=e.isAxiosError,a=e.message,o=void 0===a?t:a,u=e.response,s=void 0===u?{}:u;if(n){var i=s.status,l=void 0===i?500:i,c=s.headers,f=void 0===c?{}:c;r.status=l,r.statusText=o;var d=f["x-request-id"];d&&(r["x-request-id"]=d)}}return r}function doFetch(){return _doFetch.apply(this,arguments)}function _doFetch(){return(_doFetch=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="string"==typeof t?{url:t,method:"GET"}:_objectSpread$2({},t),e.prev=1,a=r.url,delete r.url,e.next=6,fetch(a,r);case 6:n=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),WrappedFetchError.fromFetchError(e.t0);case 12:if(n.ok){e.next=14;break}throw new WrappedFetchError(void 0,n.status,Object.fromEntries(n.headers.entries()));case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function submitRequestAndRetry(){return _submitRequestAndRetry.apply(this,arguments)}function _submitRequestAndRetry(){return(_submitRequestAndRetry=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,doFetch(t);case 2:if(n=e.sent,a=n.status,!r||!r(a)){e.next=8;break}throw(o=new WrappedFetchError("retrying request per client",a)).forceSkip=!0,o;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function handleRetry(e,t){var r=e&&e.forceSkip;return t&&!r?t(getHttpErrorInfo(e).status):!(!r&&!isRetryError(e))}function submitHttpRequest(){return _submitHttpRequest.apply(this,arguments)}function _submitHttpRequest(){return _submitHttpRequest=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o,u,s,i,l=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=l.length>1&&void 0!==l[1]?l[1]:{}).retryCount,a=void 0===n?3:n,o=r.retryDelay,u=void 0===o?1e3:o,s=r.retryFunction,i=void 0!==s&&s,e.abrupt("return",exponentialBackoff.backOff((function(){return submitRequestAndRetry(t,i)}),{numOfAttempts:a,retry:function(e){return handleRetry(e,i)},startingDelay:u}));case 3:case"end":return e.stop()}}),e)}))),_submitHttpRequest.apply(this,arguments)}var HttpClient=function(){function e(){_classCallCheck__default.default(this,e)}var t;return _createClass__default.default(e,[{key:"submitRequest",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,submitHttpRequest(t,r);case 3:return n=e.sent,e.abrupt("return",n);case 7:throw e.prev=7,e.t0=e.catch(0),a=getHttpErrorInfo(e.t0),new Error(JSON.stringify(a));case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return t.apply(this,arguments)})}]),e}();function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){_defineProperty__default.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var actions={doFetchWithOptions:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,n,a,o,u,s,i,l,c,f,d,p,_,m=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=m.length>1?m[1]:void 0,n=m.length>2&&void 0!==m[2]?m[2]:{},a=m.length>4?m[4]:void 0,o=m.length>5&&void 0!==m[5]?m[5]:1,u=m.length>6&&void 0!==m[6]?m[6]:function(){},s=_objectSpread$1(_objectSpread$1({method:t=m.length>0&&void 0!==m[0]?m[0]:"GET",headers:m.length>3&&void 0!==m[3]?m[3]:{}},m.length>7&&void 0!==m[7]?m[7]:{}),{},{body:a,url:utils.fillTemplate(r,n)}),a&&(s.body=JSON.stringify(a)),Logger.log(exports.LogLevel.INFO,{message:" > pc ".concat(t," ").concat(s.url),requestUrl:s.url,requestMethod:t}),i=new HttpClient,e.prev=12,e.next=15,i.submitRequest(s,{retryCount:o,retryFunction:u});case 15:l=e.sent,e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(12),Logger.log(exports.LogLevel.SEVERE,{message:" < pc failed to send ".concat(s.url),requestUrl:s.url,requestMethod:t}),e.t0;case 22:return f=(c=l).status,d=c.headers,p=d.has("x-request-id")?d.get("x-request-id"):"NO ID",_=f<400?exports.LogLevel.INFO:exports.LogLevel.SEVERE,Logger.log(_,{message:" < pc ".concat(t," ").concat(f," [").concat(p,"] ").concat(s.url),requestUrl:s.url,requestMethod:t,responseStatus:f,xRequestId:p}),e.abrupt("return",l);case 27:case"end":return e.stop()}}),e,null,[[12,18]])})));return function(){return e.apply(this,arguments)}}(),doFetch:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,n,a,o,u,s,i,l,c,f=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:"GET",r=f.length>1?f[1]:void 0,n=f.length>2?f[2]:void 0,a=f.length>3&&void 0!==f[3]?f[3]:{},o=f.length>4&&void 0!==f[4]?f[4]:{},u=f.length>5?f[5]:void 0,s=f.length>6&&void 0!==f[6]?f[6]:"default",i=f.length>7&&void 0!==f[7]?f[7]:1,l=f.length>8&&void 0!==f[8]?f[8]:function(){},c=utils.getHeader(o,n),e.abrupt("return",actions.doFetchWithOptions(t,r,a,c,u,i,l,{cache:s}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doGet:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i,l=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>2&&void 0!==l[2]?l[2]:{},a=l.length>3&&void 0!==l[3]?l[3]:{},o=l.length>4&&void 0!==l[4]?l[4]:"default",u=l.length>5&&void 0!==l[5]?l[5]:1,s=l.length>6&&void 0!==l[6]?l[6]:function(){},e.next=7,actions.doFetch("GET",t,r,n,a,void 0,o,u,s);case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doHead:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:{},a=u.length>3&&void 0!==u[3]?u[3]:{},e.next=4,actions.doFetch("HEAD",t,r,n,a);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doPost:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i,l,c=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:{},o=c.length>4?c[4]:void 0,u=c.length>5&&void 0!==c[5]?c[5]:"default",s=c.length>6&&void 0!==c[6]?c[6]:0,i=c.length>7&&void 0!==c[7]?c[7]:void 0,e.next=8,actions.doFetch("POST",t,r,n,a,o,u,s,i);case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doPoll:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=i.length>2&&void 0!==i[2]?i[2]:{},o=a=3e3;case 3:return e.next=5,actions.doGet(t,r,{},n,"default",0);case 5:return(u=e.sent).headers.has("retry-after")&&(o=1e3*(o=u.headers.get("retry-after"))>a?a:1e3*o),s=function(e){return new Promise((function(t){setTimeout(t,e)}))},e.next=10,s(o);case 10:if(u&&202===u.status){e.next=3;break}case 11:return e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doPostAsync:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},a=i.length>3&&void 0!==i[3]?i[3]:{},o=i.length>4?i[4]:void 0,e.next=5,actions.doPost(t,r,n,a,o);case 5:if(!((u=e.sent)&&202===u.status&&u.headers&&u.headers.has("location"))){e.next=9;break}return s=u.headers.get("location"),e.abrupt("return",actions.doPoll(s,r,a));case 9:return e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doDelete:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:{},a=s.length>3&&void 0!==s[3]?s[3]:{},o=s.length>4?s[4]:void 0,e.next=5,actions.doFetch("DELETE",t,r,n,a,o);case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doPut:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:{},a=s.length>3&&void 0!==s[3]?s[3]:{},o=s.length>4?s[4]:void 0,e.next=5,actions.doFetch("PUT",t,r,n,a,o);case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doPatch:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:{},a=s.length>3&&void 0!==s[3]?s[3]:{},o=s.length>4?s[4]:void 0,e.next=5,actions.doFetch("PATCH",t,r,n,a,o);case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doXhrPost:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i,l,c=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:{},o=c.length>4&&void 0!==c[4]?c[4]:null,u=c.length>5?c[5]:void 0,s=utils.getHeader(a,r),i=utils.fillTemplate(t,n),e.next=8,new Promise((function(e,r){var n,a=new XMLHttpRequest;for(var l in a.open("POST",i,!0),s)s.hasOwnProperty(l)&&"content-length"!==l.toLowerCase()&&a.setRequestHeader(l,s[l]);null!==(n=global)&&void 0!==n&&n.isNodeEnv||a.upload.addEventListener("progress",(function(e){return u.onProgress&&u.onProgress(e)})),a.onerror=function(e){r(e)},a.onreadystatechange=function(){return utils.returnXHRResponse(a,"POST",e,r,i)},Logger.log(exports.LogLevel.INFO,{message:" > pc POST ".concat(t),requestUrl:t,requestMethod:"POST",filledTemplate:i}),a.send(o||null)}));case 8:return l=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),doXhrPut:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i,l,c=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:{},o=c.length>4&&void 0!==c[4]?c[4]:null,s={},(u=c.length>5?c[5]:void 0).update&&(s=utils.getHeader(a,r)),i=utils.fillTemplate(t,n),e.next=9,new Promise((function(e,r){var n,a=new XMLHttpRequest;for(var l in s)s.hasOwnProperty(l)&&"content-length"!==l.toLowerCase()&&a.setRequestHeader(l,s[l]);null!==(n=global)&&void 0!==n&&n.isNodeEnv||a.upload.addEventListener("progress",(function(e){return u.onProgress&&u.onProgress(e)})),a.onerror=function(e){r(e)},a.onreadystatechange=function(){return utils.returnXHRResponse(a,"PUT",e,r,i)},Logger.log(exports.LogLevel.INFO,{message:" > pc PUT ".concat(t),requestUrl:t,requestMethod:"PUT",filledTemplate:i}),a.open("PUT",i,!0),a.send(o||null),blockTransfers.addXhrPut({path:i,xhr:a})}));case 9:return l=e.sent,e.abrupt("return",l);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,o=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty__default.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Operation,REPO_REPOSITORY_ID="repo:repositoryId",REPO_ASSET_ID="repo:assetId";!function(e){e.copy="copy",e.move="move",e.discard="discard",e.delete="delete",e.restore="restore"}(Operation||(Operation={}));var PlatformConnector={init:function(e){var t=e.accessToken,r=e.apiKey,n=e.platformUrl,a=e.discoveryRoot,o=e.linkNS,u=void 0===o?{}:o,s=e.customHeader,i=void 0===s?{}:s,l=e.logger;return PlatformConnector._ims.accessToken=t,PlatformConnector._ims.apiKey=r,PlatformConnector._ims.platformUrl=n,PlatformConnector._discoveryRoot=a||DISCOVERY.root,PlatformConnector._linkNS=merge__default.default(LINK_NS,u),PlatformConnector._customHeader=i,Logger.setLogger(l),clone__default.default(PlatformConnector)},_ims:{accessToken:void 0,apiKey:void 0,platformUrl:void 0},_discoveryRoot:DISCOVERY.root,_linkNS:LINK_NS,_baseURL:"",_customHeader:{},_formatIfMatch:function(e){return e["dc:format"]&&e["dc:format"].indexOf("directory")<0?{"if-match":e["repo:etag"]||"*"}:{}},getDiscovery:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,n,a,o,u,s,i,l,c,f,d,p,_,m,h,v,g,b,y,P,k,C,R,x,T,w,L;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=PlatformConnector._ims.platformUrl+PlatformConnector._discoveryRoot,e.next=3,actions.doGet(o,PlatformConnector._ims,{},{});case 3:return u=e.sent,e.next=6,u.json();case 6:if(s=e.sent,!(l=null===(t=s)||void 0===t||null===(r=t.children)||void 0===r||null===(n=r.find((function(e){return"Assets.json"===e["repo:name"]})))||void 0===n||null===(a=n._links[LINK_NS.page])||void 0===a?void 0:a.href)){e.next=38;break}return e.next=11,actions.doGet(l,PlatformConnector._ims,{limit:10},{});case 11:if(_=e.sent,m={_links:{next:{href:""}},children:void 0},200!==(null===(c=_)||void 0===c?void 0:c.status)){e.next=18;break}return e.next=16,_.json();case 16:m=e.sent,s=m;case 18:h=null===(f=m)||void 0===f||null===(d=f._links)||void 0===d||null===(p=d.next)||void 0===p?void 0:p.href;case 19:if(!h){e.next=34;break}return e.next=22,actions.doGet(h,PlatformConnector._ims,{},{});case 22:if(_=e.sent,200!==(null===(v=_)||void 0===v?void 0:v.status)){e.next=29;break}return e.next=26,_.json();case 26:m=e.sent,e.next=30;break;case 29:h=null;case 30:s.children=s.children.concat(m.children),h=null===(g=m)||void 0===g||null===(b=g._links)||void 0===b||null===(y=b.next)||void 0===y?void 0:y.href,e.next=19;break;case 34:delete s._page,delete s._links.next,e.next=47;break;case 38:if(!(T=null===(P=s)||void 0===P||null===(k=P.children)||void 0===k||null===(C=k.find((function(e){return"Index.json"===e["repo:name"]})))||void 0===C||null===(R=C._links[LINK_NS.primary])||void 0===R?void 0:R.href)){e.next=43;break}return e.next=42,actions.doGet(T,PlatformConnector._ims,{},{});case 42:i=e.sent;case 43:if(200!==(null===(x=i)||void 0===x?void 0:x.status)){e.next=47;break}return e.next=46,i.json();case 46:s=e.sent;case 47:return s._links&&(w=utils.findLink(s._links,PlatformConnector._linkNS.resolvePath))&&(L=new URL(w),PlatformConnector._baseURL=L.origin),e.abrupt("return",s);case 49:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getFederatedDiscovery:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.children.find((function(e){return e._embedded[PlatformConnector._linkNS.metadata.repo]["repo:repositoryId"]===r}))){e.next=3;break}return e.abrupt("return",t);case 3:if((a=n._embedded["Repositories.json"]._links[PlatformConnector._linkNS.primary])&&a.href){e.next=6;break}return e.abrupt("return",t);case 6:return e.next=8,actions.doGet(a.href,PlatformConnector._ims,{},{});case 8:if(o=e.sent){e.next=11;break}return e.abrupt("return",t);case 11:return e.next=13,o.json();case 13:if(u=e.sent){e.next=16;break}return e.abrupt("return",t);case 16:return u._links=u.children[0]._embedded._links,e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:"default",a=utils.findLink(t,PlatformConnector._linkNS.primary,PlatformConnector._baseURL),e.abrupt("return",actions.doGet(a,PlatformConnector._ims,r,PlatformConnector._customHeader,n));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getResourceByPath:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:"default",a=utils.findLink(t,PlatformConnector._linkNS.resolvePath,PlatformConnector._baseURL),e.next=4,actions.doHead(a,PlatformConnector._ims,r,PlatformConnector._customHeader);case 4:return o=e.sent,u=utils.extractLinksFromHeaders(o.headers),e.abrupt("return",PlatformConnector.getResource(u,r,n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getResourceById:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:"default",a=utils.findLink(t,PlatformConnector._linkNS.resolveId,PlatformConnector._baseURL),e.next=4,actions.doHead(a,PlatformConnector._ims,r,PlatformConnector._customHeader);case 4:return o=e.sent,u=utils.extractLinksFromHeaders(o.headers),e.abrupt("return",PlatformConnector.getResource(u,r,n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getLinksByPath:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.resolvePath,PlatformConnector._baseURL),e.prev=1,e.next=4,actions.doGet(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 4:return a=e.sent,e.next=7,a.json();case 7:return o=e.sent,e.abrupt("return",o._links);case 11:return e.prev=11,e.t0=e.catch(1),e.next=15,actions.doHead(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 15:return u=e.sent,e.abrupt("return",utils.extractLinksFromHeaders(u.headers));case 17:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),getLinksById:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.resolveId,PlatformConnector._baseURL),e.next=3,actions.doHead(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 3:return a=e.sent,e.abrupt("return",utils.extractLinksFromHeaders(a.headers));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getHeadByPath:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.resolvePath,PlatformConnector._baseURL),e.next=3,actions.doHead(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkResourceExistsByPath:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.resolvePath,PlatformConnector._baseURL),e.next=3,actions.doHead(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkResourceExistsById:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.resolveId,PlatformConnector._baseURL),e.next=3,actions.doHead(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),applyLinkTemplate:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>2&&void 0!==s[2]?s[2]:"GET",a=s.length>3?s[3]:void 0,o=s.length>4?s[4]:void 0,e.t0=n,e.next="POST"===e.t0?6:"PUT"===e.t0?8:"PATCH"===e.t0?10:"DELETE"===e.t0?12:"HEAD"===e.t0?14:16;break;case 6:return u=actions.doPost,e.abrupt("break",18);case 8:return u=actions.doPut,e.abrupt("break",18);case 10:return u=actions.doPatch,e.abrupt("break",18);case 12:return u=actions.doDelete,e.abrupt("break",18);case 14:return u=actions.doHead,e.abrupt("break",18);case 16:return u=actions.doGet,e.abrupt("break",18);case 18:return e.abrupt("return",u(t,PlatformConnector._ims,r,a,o));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getPage:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},n=!(s.length>2&&void 0!==s[2])||s[2],a=s.length>3&&void 0!==s[3]?s[3]:"default",o=utils.findLink(t,n?PlatformConnector._linkNS.page:PlatformConnector._linkNS.next,PlatformConnector._baseURL),e.next=6,actions.doGet(o,PlatformConnector._ims,r,PlatformConnector._customHeader,a);case 6:return u=e.sent,e.abrupt("return",u.json());case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getPermission:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,PlatformConnector._linkNS.acEffective,PlatformConnector._baseURL),e.next=3,actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader);case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRendition:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a,o,u,s,i,l,c,f,d,p=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>2&&void 0!==p[2]?p[2]:"default",a=p.length>3&&void 0!==p[3]&&p[3],o=PlatformConnector._linkNS.rendition,u=utils.findLink(t,o,PlatformConnector._baseURL),!a){e.next=10;break}return e.next=7,actions.doFetchWithOptions("GET",u,r);case 7:s=e.sent,e.next=13;break;case 10:return e.next=12,actions.doGet(u,PlatformConnector._ims,r,PlatformConnector._customHeader,n);case 12:s=e.sent;case 13:return l=Array.isArray(t[o])?t[o].filter((function(e){return"id"===e.mode})).concat(t[o]):[t[o]],c=_slicedToArray__default.default(l,1),(f=c[0])&&f.type&&(i={type:f.type}),e.next=17,s.arrayBuffer();case 17:return d=e.sent,e.abrupt("return",URL.createObjectURL(new Blob([new Uint8Array(d)],i)));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRepoMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"default",n=utils.findLink(t,PlatformConnector._linkNS.metadata.repo,PlatformConnector._baseURL),e.next=4,actions.doGet(n,PlatformConnector._ims,{},PlatformConnector._customHeader,r);case 4:return a=e.sent,e.abrupt("return",a.json());case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getEmbeddedMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"default",n=utils.findLink(t,PlatformConnector._linkNS.metadata.embedded,PlatformConnector._baseURL),e.abrupt("return",actions.doGet(n,PlatformConnector._ims,{},_objectSpread({Accept:"application/json"},PlatformConnector._customHeader),r));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getApplicationMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"default",n=utils.findLink(t,PlatformConnector._linkNS.metadata.app,PlatformConnector._baseURL),e.abrupt("return",actions.doGet(n,PlatformConnector._ims,{},PlatformConnector._customHeader,r));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getAssetMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"default",n=utils.findLink(t,PlatformConnector._linkNS.metadata.asset,PlatformConnector._baseURL),e.abrupt("return",actions.doGet(n,PlatformConnector._ims,{},PlatformConnector._customHeader,r));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setApplicationMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",PlatformConnector.setApplicationMetadataBulkOperation(t,[{name:r,value:n}],a));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setApplicationMetadataBulkOperation:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=utils.findLink(t,PlatformConnector._linkNS.metadata.app,PlatformConnector._baseURL),o=r.map((function(e){return{op:"add",path:"/".concat(e.name),value:e.value}})),e.abrupt("return",actions.doPatch(a,PlatformConnector._ims,void 0,_objectSpread(_objectSpread({"Content-Type":"application/json-patch+json"},n&&{"If-Match":n}),PlatformConnector._customHeader),o));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setAssetMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",PlatformConnector.setAssetMetadataBulkOperation(t,[{name:r,value:n}],a));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setAssetMetadataBulkOperation:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=utils.findLink(t,PlatformConnector._linkNS.metadata.asset,PlatformConnector._baseURL),o=r.map((function(e){return{op:"add",path:"/".concat(e.name),value:e.value}})),e.abrupt("return",actions.doPatch(a,PlatformConnector._ims,void 0,_objectSpread(_objectSpread({"Content-Type":"application/json-patch+json"},n&&{"If-Match":n}),PlatformConnector._customHeader),o));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),addToCollection:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",updateCollection("add",t,r));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),removeFromCollection:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",updateCollection("remove",t,r));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),query:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o,u=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},n=u.length>2&&void 0!==u[2]?u[2]:"default",a=utils.findLink(t,PlatformConnector._linkNS.query,PlatformConnector._baseURL),e.next=5,actions.doGet(a,PlatformConnector._ims,r,PlatformConnector._customHeader,n);case 5:return o=e.sent,e.abrupt("return",o.json());case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getAllMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"default",n=[PlatformConnector._linkNS.metadata.app,PlatformConnector._linkNS.metadata.embedded,PlatformConnector._linkNS.metadata.repo],a=n.filter((function(e){return t[e]})).map((function(e){return{resource:{reltype:e}}})),e.abrupt("return",PlatformConnector.query(t,{embed:JSON.stringify(a)},r));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getMetadata:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"default",n=[PlatformConnector._linkNS.metadata.asset,PlatformConnector._linkNS.metadata.repo],a=n.filter((function(e){return t[e]})).map((function(e){return{resource:{reltype:e}}})),e.abrupt("return",PlatformConnector.query(t,{embed:JSON.stringify(a)},r));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getVersions:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,PlatformConnector._linkNS.version,PlatformConnector._baseURL),e.next=3,actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader);case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getSearchableFields:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,PlatformConnector._linkNS.searchableFields,PlatformConnector._baseURL),e.next=3,actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader);case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),copyResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){var o,u,s,i,l,c,f;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=utils.findLink(t,PlatformConnector._linkNS.ops,PlatformConnector._baseURL),u=[],s=_createForOfIteratorHelper(r);try{for(s.s();!(i=s.n()).done;)l=i.value,c=utils.extractFileName(l[PlatformConnectorConstants.REPO_PATH]),u.push({op:Operation.copy,source:_objectSpread(_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,l[PlatformConnectorConstants.REPO_PATH]),PlatformConnector._formatIfMatch(l)),target:_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,utils.formatDirectoryPath(n[PlatformConnectorConstants.REPO_PATH])+c)})}catch(e){s.e(e)}finally{s.f()}return f=1===u.length?u[0]:u,e.abrupt("return",actions.doPostAsync(o,PlatformConnector._ims,{},_objectSpread({"Content-Type":"application/vnd.adobe.asset-operation+json"},PlatformConnector._customHeader),f));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),renameSingleResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){var o,u,s,i,l,c;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=utils.findLink(t,PlatformConnector._linkNS.ops,PlatformConnector._baseURL),u=r[PlatformConnectorConstants.REPO_PATH],s=u.substring(0,u.lastIndexOf("/")),i=utils.formatDirectoryPath(s)+n,l={op:Operation.move,source:_objectSpread(_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,r[PlatformConnectorConstants.REPO_PATH]),PlatformConnector._formatIfMatch(r)),target:_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,i)},e.next=7,actions.doPostAsync(o,PlatformConnector._ims,{},{"Content-Type":"application/vnd.adobe.asset-operation+json"},l);case 7:return c=e.sent,e.abrupt("return",c.json());case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),moveResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){var o,u,s,i,l,c,f;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=utils.findLink(t,PlatformConnector._linkNS.ops,PlatformConnector._baseURL),u=[],s=_createForOfIteratorHelper(r);try{for(s.s();!(i=s.n()).done;)l=i.value,c=utils.extractFileName(l[PlatformConnectorConstants.REPO_PATH]),u.push({op:Operation.move,source:_objectSpread(_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,l[PlatformConnectorConstants.REPO_PATH]),PlatformConnector._formatIfMatch(l)),target:_defineProperty__default.default({"repo:repositoryId":a},PlatformConnectorConstants.REPO_PATH,utils.formatDirectoryPath(n[PlatformConnectorConstants.REPO_PATH])+c)})}catch(e){s.e(e)}finally{s.f()}return f=1===u.length?u[0]:u,e.abrupt("return",actions.doPostAsync(o,PlatformConnector._ims,{},_objectSpread({"Content-Type":"application/vnd.adobe.asset-operation+json"},PlatformConnector._customHeader),f));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pollForProcessed:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",actions.doPoll(t,PlatformConnector._ims,PlatformConnector._ims));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),move:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",operation(Operation.move,t,{sources:r,target:n},a));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),copy:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",operation(Operation.copy,t,{sources:r,target:n},a));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),discard:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]&&o[3],e.abrupt("return",operation(Operation.discard,t,{targets:r},n,{forceOperation:a}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),discardSingleResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.discard,PlatformConnector._baseURL),e.abrupt("return",actions.doPost(n,PlatformConnector._ims,{repositoryId:r},PlatformConnector._customHeader));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),discardResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]&&o[3],e.abrupt("return",ops(Operation.discard,t,r,n,{forceOperation:a}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),deleteResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(u.length>3&&void 0!==u[3])||u[3],o=!(u.length>4&&void 0!==u[4])||u[4],e.abrupt("return",ops("delete",t,r,n,{recursive:a,forceOperation:o}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),restoreResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ops("restore",t,r,n));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),packageResources:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>3&&void 0!==i[3]?i[3]:void 0,o=utils.findLink(t,PlatformConnector._linkNS.ops,PlatformConnector._baseURL),n.forEach((function(e){e["repo:repositoryId"]=r})),u=_objectSpread({op:"package",source:n},a&&{package_name:a}),e.next=6,actions.doPostAsync(o,PlatformConnector._ims,{repositoryId:r},_objectSpread({"Content-Type":"application/vnd.adobe.asset-operation+json"},PlatformConnector._customHeader),u);case 6:return s=e.sent,e.abrupt("return",s.json());case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),createFolder:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.create,PlatformConnector._baseURL),e.abrupt("return",actions.doPost(n,PlatformConnector._ims,{path:r,intermediates:!0,respondWith:'{"reltype":"'.concat(PlatformConnector._linkNS.metadata.repo,'"}')},_objectSpread({"Content-Type":PlatformConnectorConstants.DIRECTORY_TYPE},PlatformConnector._customHeader)));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),createResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]?s[3]:{},o=utils.findLink(t,PlatformConnector._linkNS.create,PlatformConnector._baseURL),u=!0===(null==a?void 0:a.intermediates)||void 0===(null==a?void 0:a.intermediates),e.abrupt("return",actions.doPost(o,PlatformConnector._ims,{path:r,intermediates:u,respondWith:(null==a?void 0:a.respondWith)||void 0},_objectSpread({"Content-Type":(null==a?void 0:a.contentType)||PlatformConnectorConstants.RESOURCE_TYPE},PlatformConnector._customHeader),n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),updateResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,PlatformConnector._linkNS.primary,PlatformConnector._baseURL),e.abrupt("return",actions.doPut(n,PlatformConnector._ims,{},_objectSpread({"Content-Type":PlatformConnectorConstants.RESOURCE_TYPE},PlatformConnector._customHeader),r));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),uploadFile:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u,s,i,l,c;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},o=n.update?"":utils.findLink(t,PlatformConnector._linkNS.create,PlatformConnector._baseURL),(u=r.type)&&""!==u||(u=getMimeTypeFromExtension(r.name.split(".").pop())),s=function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.slice(t,n),e.abrupt("return",new Promise((function(e){var t=new FileReader;t.onloadend=function(t){var r;e(null===(r=t.target)||void 0===r?void 0:r.result)},t.readAsArrayBuffer(a)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=_objectSpread(_objectSpread({},n),{},{contentLength:r.size,onSliceBuffer:s,type:u}),e.next=8,PlatformConnector._blockUploadInit(o,r,i);case 8:return l=e.sent,e.next=11,PlatformConnector.execBlockUpload(l);case 11:if(c=e.sent,l.state===PlatformConnectorConstants.UPLOAD_STATE.FINISHED){e.next=14;break}return e.abrupt("return",c);case 14:return blockTransfers._removeBlockUploadById(l.id),a.path=l.fileName,n.verbose&&(a.createResponse=l.createResponse,a.initResponse=l.initResponse,a.transferDocument=l.transferDocument,a.blockTransferResponses=null==c?void 0:c.blockTransferResponses,a.finalizeResponse=null==c?void 0:c.finalizeResponse),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_prepareBlockUploadPayloadOnOptions:function(e){var t={"repo:size":e.contentLength,"repo:blocksize":e.blockSize||PlatformConnectorConstants.UPLOAD_BLOCKS.UPLOAD_BLOCKSIZE,"dc:format":e.type},r=e.blockUploadPayloadForRelType?e.blockUploadPayloadForRelType:{"repo:resource":{"repo:reltype":PlatformConnector._linkNS.primary}};return Object.assign(t,r)},_blockUploadInit:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u,s,i,l,c,f,d,p,_,m;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=LINK_NS.blockUploadInit,i=n.relativeTargetDirectory,l=i?"".concat(i,"/").concat(r.name):r.name,n.update){e.next=11;break}return e.next=6,actions.doPost(t,PlatformConnector._ims,{path:l,intermediates:!0},_objectSpread({"Content-Type":n.type},PlatformConnector._customHeader));case 6:o=e.sent,u=utils.extractLinksFromHeaders(o.headers),s=o.headers.get("etag"),e.next=13;break;case 11:u=n.updateOptions.links,s=n.updateOptions.ifMatch;case 13:return e.prev=13,e.next=16,actions.doPost(utils.findLink(u,a,PlatformConnector._baseURL),PlatformConnector._ims,{},_objectSpread({"Content-Type":"application/vnd.adobecloud.bulk-transfer+json"},PlatformConnector._customHeader),Object.assign(PlatformConnector._prepareBlockUploadPayloadOnOptions(n),{"repo:md5":null},{"repo:expires":null},{"repo:if-match":null===s?null:"".concat(s)},{"repo:if-none-match":null},{_links:null}),"default",3,(function(e){return 404===e}));case 16:if(200!==(c=e.sent).status){e.next=28;break}return e.next=20,c.json();case 20:f=e.sent,d=f["repo:blocksize"];try{p=utils.findLink(u,PlatformConnector._linkNS.discard,PlatformConnector._baseURL)}catch(e){}return _={id:"".concat(n.targetDirectory,"/").concat(r.name),etag:s,state:"PENDING",completedBlocks:0,bytesRemaining:r.size,fileName:r.name,blockSize:d,links:f._links,options:n,discardAsset:p,createResponse:o,initResponse:c,transferDocument:f},blockTransfers.addBlockUpload(_),e.abrupt("return",_);case 28:throw new Error("blockUploadInit status ".concat(c.status));case 29:e.next=35;break;case 31:if(e.prev=31,e.t0=e.catch(13),n.onAbortUpload){try{m=utils.findLink(u,PlatformConnector._linkNS.discard,PlatformConnector._baseURL)}catch(e){}n.onAbortUpload({uploadAsset:"".concat(n.targetDirectory,"/").concat(r.name),discardAssetUrl:m})}throw e.t0;case 35:case"end":return e.stop()}}),e,null,[[13,31]])})));return function(){return e.apply(this,arguments)}}(),execBlockUpload:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a,o,u,s,i,l;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={blockTransferResponses:new Array,finalizeResponse:void 0},t.state===PlatformConnectorConstants.UPLOAD_STATE.RESUMING&&t.options.onResume&&t.options.onResume(),t.state=PlatformConnectorConstants.UPLOAD_STATE.ACTIVE,a=t.links[PlatformConnector._linkNS.blockTransfer].map((function(e){return e.href})),o=t.links[PlatformConnector._linkNS.blockFinalize].href,o=null===(r=o)||void 0===r?void 0:r.replace("{&repoMetaPatch*}",""),u={},"ifMatch"in t.options&&(u["If-Match"]=t.options.ifMatch),s=_regeneratorRuntime__default.default.mark((function(){var e,r,o,u,l,c,f,d,p,_,m;return _regeneratorRuntime__default.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!(t.bytesRemaining<=0)){s.next=3;break}return t.completedBlocks=a.length,s.abrupt("return","break");case 3:return e=t.options.contentLength,r=t.blockSize,l=(o=i*r)+(u=o+r>e?e-o+1:r),s.next=10,t.options.onSliceBuffer(o,l);case 10:c=s.sent,f=function(e){console.debug("Upload progress - loaded: event.loaded"),t.options.onProgress&&t.options.onProgress({loaded:e.loaded+o,total:t.options.contentLength})},d=0,p=!1,_=t.options.blockRetries||PlatformConnectorConstants.UPLOAD_BLOCKS.UPLOAD_BLOCK_RETRY_DEFAULT;case 15:if(p||t.state!==PlatformConnectorConstants.UPLOAD_STATE.ACTIVE||!(d++<=_)){s.next=38;break}return s.prev=16,s.next=19,actions.doXhrPut(a[i],PlatformConnector._ims,{},{},c,{onProgress:f});case 19:if(m=s.sent){s.next=22;break}throw new Error("actions.doXhrPut failed to return response");case 22:if(!m.ok||200!==m.status&&201!==m.status){s.next=26;break}p=!0,s.next=28;break;case 26:if(!(d>=_)){s.next=28;break}throw new Error("BlockTransferLink".concat(i," failed  due to CORS or other network issues"));case 28:n.blockTransferResponses.push(m),s.next=36;break;case 31:if(s.prev=31,s.t0=s.catch(16),!(d>=_)){s.next=36;break}throw t.options.onAbortUpload&&t.options.onAbortUpload({uploadAsset:t.id,discardAssetUrl:t.discardAsset}),new Error("BlockTransferLink".concat(i," failed. ").concat(s.t0));case 36:s.next=15;break;case 38:p&&(t.bytesRemaining-=u,t.completedBlocks++);case 39:case"end":return s.stop()}}),s,null,[[16,31]])})),i=t.completedBlocks;case 10:if(!(i<a.length&&t.state===PlatformConnectorConstants.UPLOAD_STATE.ACTIVE)){e.next=18;break}return e.delegateYield(s(),"t0",12);case 12:if("break"!==e.t0){e.next=15;break}return e.abrupt("break",18);case 15:i++,e.next=10;break;case 18:if(t.state===PlatformConnectorConstants.UPLOAD_STATE.ACTIVE){e.next=29;break}if(t.state!==PlatformConnectorConstants.UPLOAD_STATE.PAUSING||!t.options.onPause){e.next=24;break}t.state=PlatformConnectorConstants.UPLOAD_STATE.PAUSED,t.options.onPause({uploadInstance:t}),e.next=28;break;case 24:if(t.state!==PlatformConnectorConstants.UPLOAD_STATE.CANCELING||!t.options.onCancel){e.next=28;break}return t.state=PlatformConnectorConstants.UPLOAD_STATE.CANCELED,t.options.onCancel({uploadInstance:t}),e.abrupt("return");case 28:return e.abrupt("return");case 29:return e.prev=29,e.next=32,actions.doPost(o,PlatformConnector._ims,{},_objectSpread({"Content-Type":"application/vnd.adobecloud.bulk-transfer+json","Access-Control-Expose-Headers":"*"},PlatformConnector._customHeader),Object.assign(PlatformConnector._prepareBlockUploadPayloadOnOptions(t.options),{"repo:md5":null},{"repo:expires":null},{"repo:if-match":null===t.etag?null:"".concat(t.etag)},{"repo:if-none-match":null},{_links:t.links}),"default",3,(function(e){return 404===e}));case 32:l=e.sent,n.finalizeResponse=l,e.next=40;break;case 36:throw e.prev=36,e.t1=e.catch(29),t.options.onAbortUpload&&t.options.onAbortUpload({uploadAsset:t.id,discardAssetUrl:t.discardAsset}),new Error("BlockFinalized failed.");case 40:return t.state=PlatformConnectorConstants.UPLOAD_STATE.FINISHED,e.abrupt("return",_objectSpread({path:t.fileName},n));case 42:case"end":return e.stop()}}),e,null,[[29,36]])})));return function(){return e.apply(this,arguments)}}(),downloadSingleResource:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,PlatformConnector._linkNS.download,PlatformConnector._baseURL),e.next=3,actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader);case 3:if(200!==(n=e.sent).status){e.next=9;break}return e.next=7,n.json();case 7:return a=e.sent.href,e.abrupt("return",a);case 9:throw new Error("Get block transfer URL for download failed. It may be cause by a network error.");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getACLPolicy:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,LINK_NS.acPolicy),e.abrupt("return",actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),updateACLPolicy:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o,u,s,i,l=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>3&&void 0!==l[3]?l[3]:"merge",o=utils.findLink(t,LINK_NS.acPolicy),u=r.map((function(e){return{"repo:principal":{"xdm:provider":{"@id":"https://ims-na1.adobelogin.com/"},"@id":e.id,"@type":"https://ns.adobe.com/adobecloudplatform/ims/user"},"repo:modifier":"grant","repo:privileges":[n],"repo:relations":[LINK_NS.acPolicy,LINK_NS.primary,LINK_NS.metadata.app,LINK_NS.metadata.embedded,LINK_NS.metadata.repo,LINK_NS.rendition],"repo:inheritance":"deep"}})),s={"repo:acl":u},e.next=6,actions.doPut(o,PlatformConnector._ims,{op:a},_objectSpread({"Content-Type":"application/vnd.adobecloud.accesscontrolpolicy+json"},PlatformConnector._customHeader),s);case 6:return i=e.sent,e.abrupt("return",i.json());case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkACL:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=utils.findLink(t,LINK_NS.acCheck),e.next=3,actions.doGet(n,PlatformConnector._ims,r,PlatformConnector._customHeader);case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getACLEffective:function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=utils.findLink(t,LINK_NS.acEffective),e.next=3,actions.doGet(r,PlatformConnector._ims,{},PlatformConnector._customHeader);case 3:return n=e.sent,e.abrupt("return",n.json());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},ops=function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){var o,u,s,i,l,c,f,d=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=d.length>4&&void 0!==d[4]?d[4]:void 0,u=utils.findLink(r,PlatformConnector._linkNS.ops),s=[],i=_createForOfIteratorHelper(n);try{for(i.s();!(l=i.n()).done;)c=l.value,s.push(_objectSpread({op:t,target:_objectSpread({"repo:repositoryId":a,"repo:assetId":c["repo:assetId"]},PlatformConnector._formatIfMatch(c))},o))}catch(e){i.e(e)}finally{i.f()}return f=1===s.length?s[0]:s,e.abrupt("return",actions.doPostAsync(u,PlatformConnector._ims,{repositoryId:a},_objectSpread({"Content-Type":"application/vnd.adobe.asset-operation+json"},PlatformConnector._customHeader),f));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),operation=function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n,a){var o,u,s,i,l,c,f,d,p,_,m,h,v,g=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=g.length>4&&void 0!==g[4]?g[4]:void 0,u=utils.findLink(r,PlatformConnector._linkNS.ops),s=[],i=n.sources?n.sources:n.targets,l=_createForOfIteratorHelper(i);try{for(l.s();!(c=l.n()).done;)_=c.value,m=t===Operation.move||t===Operation.copy?utils.extractFileName(_[PlatformConnectorConstants.REPO_PATH]):"",h=t===Operation.move||t===Operation.copy?{source:_objectSpread((f={},_defineProperty__default.default(f,REPO_REPOSITORY_ID,a),_defineProperty__default.default(f,PlatformConnectorConstants.REPO_PATH,_[PlatformConnectorConstants.REPO_PATH]),f),PlatformConnector._formatIfMatch(_)),target:(d={},_defineProperty__default.default(d,REPO_REPOSITORY_ID,a),_defineProperty__default.default(d,PlatformConnectorConstants.REPO_PATH,utils.formatDirectoryPath(n.target[PlatformConnectorConstants.REPO_PATH])+m),d)}:{target:_objectSpread((p={},_defineProperty__default.default(p,REPO_REPOSITORY_ID,a),_defineProperty__default.default(p,REPO_ASSET_ID,_[REPO_ASSET_ID]),p),PlatformConnector._formatIfMatch(_))},s.push(_objectSpread(_objectSpread({op:t},h),o))}catch(e){l.e(e)}finally{l.f()}return v=1===s.length?s[0]:s,e.abrupt("return",actions.doPost(u,PlatformConnector._ims,{repositoryId:a},_objectSpread({"Content-Type":"application/vnd.adobe.asset-operation+json"},PlatformConnector._customHeader),v));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),updateCollection=function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,n){var a,o;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=utils.findLink(r,PlatformConnector._linkNS.collections,PlatformConnector._baseURL),o=n.map((function(e){return{op:t,path:"/children",value:_defineProperty__default.default({},PlatformConnectorConstants.REPO_PATH,e)}})),e.abrupt("return",actions.doPatch(a,PlatformConnector._ims,void 0,_objectSpread({"Content-Type":PlatformConnectorConstants.COLLECTION_TYPE},PlatformConnector._customHeader),o));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),BlockTransfers=function(){function e(){_classCallCheck__default.default(this,e),this._blockUploads=void 0,this.xhrPuts=void 0,this._blockUploads=[],this.xhrPuts=[]}var t,r,n,a,o;return _createClass__default.default(e,[{key:"blockUploads",get:function(){return this._blockUploads}},{key:"addBlockUpload",value:function(e){var t=this._getBlockUploadIndex(e.id);return t>=0&&this._removeBlockUpload(t),this._blockUploads.push(e),this._blockUploads.length-1}},{key:"addXhrPut",value:function(e){this.xhrPuts.push(e)}},{key:"removeXhrPut",value:function(e){var t=this.xhrPuts.findIndex((function(t){return t.path===e}));this.xhrPuts.splice(t,1)}},{key:"getBlockUpload",value:function(e){var t;return(t="number"==typeof e?e:this._getBlockUploadIndex(e))>=0?this._blockUploads[t]:null}},{key:"blockUploadState",value:function(e,t){var r;return(null===(r=this.getBlockUpload(e))||void 0===r?void 0:r.state)===t}},{key:"pauseBlockUpload",value:(o=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.blockUploadState(t,"ACTIVE")){e.next=4;break}return e.next=3,this._fastPauseUpload(this.getBlockUpload(t));case 3:return e.abrupt("return",!0);case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"resumeBlockUpload",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.blockUploadState(t,"PAUSED")||!this._validBlockUploadInstance(r)){e.next=10;break}return this.addBlockUpload(r),e.next=4,this._resumeUpload(r);case 4:if(n=e.sent,r.state!==PlatformConnectorConstants.UPLOAD_STATE.FINISHED){e.next=8;break}return this._removeBlockUploadById(r.id),e.abrupt("return",n);case 8:e.next=11;break;case 10:throw new Error("Job not found or job not paused");case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"cancelBlockUpload",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.getBlockUpload(t))||r.state!==PlatformConnectorConstants.UPLOAD_STATE.ACTIVE){e.next=9;break}return e.next=4,this._cancelUpload(r);case 4:return this._removeBlockUpload(this._getBlockUploadIndex(t)),r.options.onAbortUpload&&r.options.onAbortUpload({uploadAsset:r.id,discardAssetUrl:r.discardAsset}),e.abrupt("return",!0);case 9:if(!r||r.state!==PlatformConnectorConstants.UPLOAD_STATE.PAUSED){e.next=14;break}return r.options.onAbortUpload&&r.options.onAbortUpload({uploadAsset:r.id,discardAssetUrl:r.discardAsset}),r.options.onCancel&&r.options.onCancel({uploadInstance:r}),this._removeBlockUpload(this._getBlockUploadIndex(t)),e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_fastPauseUpload",value:function(e){e.state=PlatformConnectorConstants.UPLOAD_STATE.PAUSING;var t=this._getBlockUploadUrl(e),r=this.xhrPuts.findIndex((function(e){return e.path===t.href})),n=this.xhrPuts[r].xhr;4!==n.readyState&&(n.abort(),this.xhrPuts=this.xhrPuts.filter((function(e){return e!==t.href})))}},{key:"_resumeUpload",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state=PlatformConnectorConstants.UPLOAD_STATE.RESUMING,e.abrupt("return",PlatformConnector.execBlockUpload(t));case 2:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"_getBlockUploadIndex",value:function(e){var t=this.blockUploads.find((function(t){return t.id===e}));return t?this.blockUploads.indexOf(t):-1}},{key:"_getBlockUploadUrl",value:function(e){var t=e.completedBlocks;return e.links[PlatformConnector._linkNS.blockTransfer][t]||null}},{key:"_cancelUpload",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var r,n,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state=PlatformConnectorConstants.UPLOAD_STATE.CANCELING,r=this._getBlockUploadUrl(t),n=this.xhrPuts.findIndex((function(e){return e.path===r.href})),4===(a=this.xhrPuts[n].xhr).readyState){e.next=8;break}return a.abort(),this.xhrPuts=this.xhrPuts.filter((function(e){return e!==r.href})),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_validBlockUploadInstance",value:function(e){for(var t=[{name:"id",type:"string"},{name:"etag",type:"string"},{name:"state",type:"string"},{name:"completedBlocks",type:"number"},{name:"fileName",type:"string"},{name:"blockSize",type:"number"},{name:"id",type:"ILinks"},{name:"options",type:"UploadOptions"}],r=t.length,n=0;n<r;n++)if(!e||!(t[n].name in e)||!_typeof__default.default(e[t[n].name]===e[t[n].type]))return!1;return!0}},{key:"_removeBlockUploadById",value:function(e){var t=this.blockUploads.find((function(t){return t.id===e})),r=t?this.blockUploads.indexOf(t):-1;return r>=0&&(this._blockUploads.splice(r,1),!0)}},{key:"_removeBlockUpload",value:function(e){return e>=0&&(this._blockUploads.splice(e,1),!0)}}]),e}(),blockTransfers=new BlockTransfers,REPOSITORY_ID_KEY="repo:repositoryId",VALID_REPO_DATE=new Date("2021-04-01T00:00:00.000Z"),REPOSITORY_FILTERS=function(e){return[function(e,t){return new Date(t["repo:modifyDate"]||t["repo:createDate"])>VALID_REPO_DATE},function(e,t,r){var n;return!r||(null===(n=e["repo:owner"])||void 0===n?void 0:n.id)===r},e?function(e){return"author"===e["aem:tier"]}:function(){return!0}]},getRepoLink=function(e){var t;return null===(t=e._embedded)||void 0===t?void 0:t[LINK_NS.repository]},getRepoMetadataLink=function(e){var t;return null===(t=e._embedded)||void 0===t?void 0:t["http://ns.adobe.com/adobecloud/rel/metadata/repository"]},getRepoId=function(e){var t;return null===(t=getRepoLink(e))||void 0===t?void 0:t[REPOSITORY_ID_KEY]},getRepoList=function(e,t){return(null!=e&&e.children?e.children:[]).filter((function(e){return REPOSITORY_FILTERS(!0).every((function(r){return Boolean(getRepoLink(e))&&Boolean(getRepoMetadataLink(e))&&r(getRepoLink(e),getRepoMetadataLink(e),t)}))}))},getDefaultSelectedRepo=function(e,t,r){var n=getRepoList(e,t);if(r){var a=n.filter((function(e){var t;return(null===(t=getRepoLink(e))||void 0===t?void 0:t[REPOSITORY_ID_KEY])===r}));if(a.length>0)return a[0]&&getRepoId(a[0])}var o=n.filter((function(e){var t=getRepoLink(e);return t&&"prod"===t["repo:environment"]&&!t["aem:sandbox"]}));return o.length>0?o[0]&&getRepoId(o[0]):n[0]&&getRepoId(n[0])},getAllRepoList=function(e,t){return(null!=e&&e.children?e.children:[]).filter((function(e){return REPOSITORY_FILTERS(!1).every((function(r){return Boolean(getRepoLink(e))&&Boolean(getRepoMetadataLink(e))&&r(getRepoLink(e),getRepoMetadataLink(e),t)}))}))};function doop(e,t,r){"function"==typeof e&&e.apply(r,t)}function toDataUrl(e,t){var r="data:";return t&&(r+="".concat(t,";")),/text/i.test(t)?(r+="charset=utf-8,",r+=e.toString("utf8")):(r+="base64,",r+=e.toString("base64")),r}function mapDataToFormat(e,t,r,n){switch(r){case"buffer":return t;case"binary":return t.toString("binary");case"dataUrl":return toDataUrl(t,e.type);case"text":return t.toString(n||"utf8")}}function FileReader$1(){var e,t=this,r=new events.EventEmitter;function n(n,a,o){if(!(e=n)||!(e.path||e.stream||e.buffer))throw new Error("cannot read as File: ".concat(JSON.stringify(e)));0===t.readyState?process.nextTick((function(){t.readyState=t.LOADING,r.emit("loadstart"),function(){var r=new events.EventEmitter,n=t.nodeChunkedEncoding;if(!e.size&&n&&e.path&&fs__default.default.stat(e.path,(function(t,r){e.size=r.size,e.lastModifiedDate=r.mtime})),e.buffer=e._parts,e.buffer)return process.nextTick((function(){r.emit("data",e.buffer),r.emit("end")})),void(e.stream=r);if(e.path){if(!n)return fs__default.default.readFile(e.path,(function(e,t){e&&r.emit("error",e),t&&(r.emit("data",t),r.emit("end"))})),void(e.stream=r);e.stream=fs__default.default.createReadStream(e.path)}}(),function(n,a){var o=e.stream,u=[];u.dataLength=0,o.on("error",(function(e){t.DONE!==t.readyState&&(t.readyState=t.DONE,t.error=e,r.emit("error",e))})),o.on("data",(function(n){t.DONE!==t.readyState&&(u.dataLength+=n.length,u.push(n),r.emit("progress",{lengthComputable:!isNaN(e.size),loaded:u.dataLength,total:e.size}),r.emit("data",n))})),o.on("end",(function(){var o;t.DONE!==t.readyState&&(o=u.length>1?Buffer.concat(u):u[0],t.readyState=t.DONE,t.result=mapDataToFormat(e,o,n,a),r.emit("load",{target:{nodeBufferResult:o,result:t.result}}),r.emit("loadend",{target:{result:t.result[0]}}))}))}(a,o),r.on("start",(function(){doop(t.onloadstart,arguments)})),r.on("progress",(function(){doop(t.onprogress,arguments)})),r.on("error",(function(e){if(t.onerror)t.onerror(e);else if(!r.listeners.error||!r.listeners.error.length)throw e})),r.on("load",(function(){doop(t.onload,arguments)})),r.on("end",(function(){doop(t.onloadend,arguments)})),r.on("loadend",(function(){doop(t.onloadend,arguments)})),r.on("abort",(function(){doop(t.onabort,arguments)}))})):console.log("already loading, request to change format ignored")}t.addEventListener=function(e,t){r.on(e,t)},t.removeEventListener=function(e){r.removeListener(e)},t.dispatchEvent=function(e){r.emit(e)},t.EMPTY=0,t.LOADING=1,t.DONE=2,t.error=void 0,t.readyState=t.EMPTY,t.result=void 0,t.on=function(){r.on.apply(r,arguments)},t.nodeChunkedEncoding=!1,t.setNodeChunkedEncoding=function(e){t.nodeChunkedEncoding=e},r.on("abort",(function(){t.readyState=t.DONE})),t.abort=function(){t.readState!=t.DONE&&(t.readyState=t.DONE,r.emit("abort"))},t.readAsArrayBuffer=function(e){n(e,"buffer")},t.readAsBinaryString=function(e){n(e,"binary")},t.readAsDataURL=function(e){n(e,"dataUrl")},t.readAsText=function(e,t){n(e,"text",t)}}global.fetch=global.fetch?global.fetch:nodeFetch__default.default,global.File=global.File?global.File:webFilePolyfill.File,global.FileReader=global.FileReader?global.FileReader:FileReader$1,global.Headers=global.Headers?global.Headers:HeadersPolyfill__default.default,global.atob=global.atob?global.atob:atobPolyfill__default.default,global.URL=global.URL?global.URL:urlPolyfill__default.default.URL,global.Blob=global.Blob?global.Blob:blobPolyfill.Blob,global.XMLHttpRequest=xmlhttprequest.XMLHttpRequest,global.isNodeEnv=!0,exports.ConsoleLogger=ConsoleLogger,exports.DISCOVERY=DISCOVERY,exports.LINK_NS=LINK_NS,exports.PlatformConnector=PlatformConnector,exports.PlatformConnectorConstants=PlatformConnectorConstants,exports.blockTransfers=blockTransfers,exports.getAllRepoList=getAllRepoList,exports.getDefaultSelectedRepo=getDefaultSelectedRepo,exports.getMimeTypeFromExtension=getMimeTypeFromExtension,exports.getRepoList=getRepoList;